<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sudoku - VIBELAND</title>
  <link rel="stylesheet" type="text/css" href="../assets/styles.css">
  <style type="text/css">
    .sudoku {
      width: 390px;
      margin-left: auto;
      margin-right: auto;
    }

    button {
      padding: 10px 0;
      font-size: 1rem;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 1px;
      background-color: #ccc;
      width: 360px;
      margin: 20px auto;
      padding: 1px;
    }

    .cell {
      background-color: white;
      border: none;
      text-align: center;
      font-size: 1.2rem;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cell.given {
      background-color: #f0f0f0;
      color: #333;
      font-weight: bold;
    }

    .cell input {
      width: 100%;
      height: 100%;
      border: none;
      text-align: center;
      font-size: 1.2rem;
      background: transparent;
    }

    .cell input:focus {
      outline: none;
      background-color: #e6f3ff;
    }

    .subgrid-border {
      border: 2px solid #333;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      margin: 20px auto;
      width: 360px;
    }

    .status {
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
      color: #333;
    }

    .difficulty-selector {
      text-align: center;
      margin: 10px 0;
    }

    .difficulty-selector label {
      margin-right: 5px;
      font-weight: bold;
    }

    .difficulty-selector select {
      padding: 5px;
      font-size: 1rem;
      border: 1px solid #ccc;
      background-color: white;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="outer-border">
      <div class="header">
        <h1>üî¢ SUDOKU üî¢</h1>
        <p>~*~ Number Puzzle Challenge ~*~</p>
      </div>

      <div class="ticker" aria-label="site news">
        <div class="marquee">‚òÖ WELCOME TO VIBELAND ‚òÖ LOGIC & NUMBERS ‚òÖ FILL THE 9√ó9 GRID ‚òÖ</div>
      </div>

      <div class="content">
        <div class="sudoku">
      <div class="status" id="status">Select a cell and enter a number (1-9)</div>
      <div class="difficulty-selector">
        <label for="difficulty">Difficulty:</label>
        <select id="difficulty">
          <option value="easy">Easy</option>
          <option value="medium" selected>Medium</option>
          <option value="hard">Hard</option>
        </select>
      </div>
      <div class="grid-container" id="grid"></div>
      <div class="controls">
        <button class="clear" onclick="newPuzzle()">New</button>
        <button onclick="clearBoard()">Clear</button>
        <button onclick="checkSolution()">Check</button>
        <button onclick="solvePuzzle()">Solve</button>
        <button onclick="clearHints()">Hints</button>
      </div>
        </div>

        <hr class="thick">

        <div class="footer">
          <div><a href="../home">‚Üê Back to VIBELAND</a></div>
          <div>¬© 1999 VIBELAND - All Rights Reserved</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sudoku board representation: 9x9 array, 0 for empty, 1-9 for filled
    let board = [];
    let originalBoard = []; // To track given cells
    let solvedBoard = []; // To store the solution for hints/checking

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generateSolvedBoard() {
      let b = Array(9).fill().map(() => Array(9).fill(0));
      fillBoard(b);
      return b;
    }

    function fillBoard(b) {
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          if (b[i][j] === 0) {
            let nums = shuffle([1, 2, 3, 4, 5, 6, 7, 8, 9]);
            for (let num of nums) {
              if (isSafe(b, i, j, num)) {
                b[i][j] = num;
                if (fillBoard(b)) return true;
                b[i][j] = 0;
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    function generatePuzzle(numToRemove) {
      let solved = generateSolvedBoard();
      let puzzle = solved.map(row => [...row]);
      // Collect all cells
      let cells = [];
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          cells.push([i, j]);
        }
      }
      shuffle(cells);
      // Remove cells to create puzzle
      for (let k = 0; k < numToRemove; k++) {
        let [i, j] = cells[k];
        puzzle[i][j] = 0;
      }
      return {puzzle, solved};
    }

    function initBoard() {
      const diff = document.getElementById('difficulty').value;
      const numToRemove = {easy: 40, medium: 50, hard: 60}[diff];
      const {puzzle, solved} = generatePuzzle(numToRemove);
      board = puzzle.map(row => [...row]);
      originalBoard = puzzle.map(row => [...row]);
      solvedBoard = solved;
      renderGrid();
    }

    function renderGrid() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (i % 3 === 2 && i < 8) cell.style.borderBottom = '2px solid #333';
          if (j % 3 === 2 && j < 8) cell.style.borderRight = '2px solid #333';

          const input = document.createElement('input');
          input.type = 'text';
          input.maxLength = 1;
          input.dataset.row = i;
          input.dataset.col = j;
          if (originalBoard[i][j] !== 0) {
            cell.classList.add('given');
            input.value = originalBoard[i][j];
            input.readOnly = true;
          } else {
            input.addEventListener('input', handleInput);
            input.addEventListener('keydown', handleKeydown);
          }
          cell.appendChild(input);
          grid.appendChild(cell);
        }
      }
      updateStatus();
    }

    function handleInput(e) {
      let val = e.target.value;
      if (val && !/^[1-9]$/.test(val)) {
        e.target.value = '';
        return;
      }
      const row = parseInt(e.target.dataset.row);
      const col = parseInt(e.target.dataset.col);
      board[row][col] = val ? parseInt(val) : 0;
      updateStatus();
    }

    function handleKeydown(e) {
      if (e.key >= '1' && e.key <= '9') {
        e.preventDefault();
        const input = e.target;
        input.value = e.key;
        handleInput({target: input});
      } else if (e.key === 'Backspace' || e.key === 'Delete') {
        e.target.value = '';
        const row = parseInt(e.target.dataset.row);
        const col = parseInt(e.target.dataset.col);
        board[row][col] = 0;
        updateStatus();
      }
    }

    function updateStatus() {
      const status = document.getElementById('status');
      const solved = isSolved();
      if (solved) {
        status.textContent = 'Congratulations! Puzzle Solved!';
        status.style.color = 'green';
      } else {
        status.textContent = 'Select a cell and enter a number (1-9)';
        status.style.color = '#333';
      }
    }

    function isSolved() {
      return board.every((row, i) => row.every((cell, j) => cell === solvedBoard[i][j]));
    }

    function newPuzzle() {
      initBoard();
    }

    function clearBoard() {
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          if (originalBoard[i][j] === 0) {
            board[i][j] = 0;
          }
        }
      }
      renderGrid();
    }

    function checkSolution() {
      if (isSolved()) {
        alert('Correct! Well done!');
      } else {
        alert('Not yet solved. Keep trying!');
      }
    }

    function solvePuzzle() {
      // Copy original to solve
      let toSolve = originalBoard.map(row => [...row]);
      if (solve(toSolve)) {
        // Update board to solved
        board = toSolve.map(row => [...row]);
        renderGrid();
        alert('Solved!');
      } else {
        alert('No solution found.');
      }
    }

    // Backtracking solver
    function solve(b) {
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          if (b[i][j] === 0) {
            for (let num = 1; num <= 9; num++) {
              if (isSafe(b, i, j, num)) {
                b[i][j] = num;
                if (solve(b)) return true;
                b[i][j] = 0;
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    function isSafe(b, row, col, num) {
      // Check row
      for (let j = 0; j < 9; j++) if (b[row][j] === num) return false;
      // Check column
      for (let i = 0; i < 9; i++) if (b[i][col] === num) return false;
      // Check subgrid
      const startRow = Math.floor(row / 3) * 3;
      const startCol = Math.floor(col / 3) * 3;
      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
          if (b[startRow + i][startCol + j] === num) return false;
        }
      }
      return true;
    }

    function clearHints() {
      // Clear any highlighting
      document.querySelectorAll('.cell input').forEach(input => {
        input.style.backgroundColor = '';
      });
    }

    // Initialize on load
    initBoard();

    // Keyboard navigation
    document.addEventListener('keydown', e => {
      if (e.key >= '1' && e.key <= '9') {
        const focused = document.activeElement;
        if (focused.tagName === 'INPUT') {
          focused.value = e.key;
          handleInput({target: focused});
        }
      }
    });
  </script>
</body>

</html>
